var u=(e,...t)=>String.raw({raw:e},...t),c=u;function f(e){let t=document.createElement("template");return t.innerHTML=e,t.content.cloneNode(!0)}var h=class extends HTMLElement{static tag="";static attrs={};static events=[];static define(e=this.tag){if(!e)throw new Error("Custom element must specify a tag name");customElements.define(e,this)}static get observedAttributes(){return Object.keys(this.attrs)}get styles(){}get template(){throw new Error("Custom element must specify a template")}attrs;get#t(){return this.shadowRoot??this}constructor(){super();try{this.attachShadow({mode:"open"})}catch{}}connectedCallback(){this.#h(),this.#e(),this.#r(),this.#s()}ref(e){let t=this.maybeRef(e);if(!t)throw new Error(`Ref with name ${String(e)} was not found`);return t}maybeRef(e){return this.#t.querySelector(`[data-ref="${String(e)}"]`)??void 0}refs(){let e={};return this.#t.querySelectorAll("[data-ref]").forEach(t=>{t instanceof HTMLElement&&t.dataset.ref&&(e[t.dataset.ref]=t)}),e}emit(e,t){let s=new CustomEvent(String(e),{bubbles:!0,cancelable:!0,composed:!0,detail:t});this.dispatchEvent(s)}#h(){if(this.template.startsWith("#")){let e=document.querySelector(this.template);if(!(e instanceof HTMLTemplateElement))throw new Error(`${this.template} is not a template element`);this.#t.appendChild(e.content.cloneNode(!0))}else{let e=f(this.template);this.#t.appendChild(e)}}#e(){if(!this.styles)return;if(!(this.#t instanceof ShadowRoot))throw new Error('CSS is not supported when "shadow" is disabled');let e=new CSSStyleSheet;e.replaceSync(this.styles),this.#t.adoptedStyleSheets.push(e)}#s(){let{events:e}=this.constructor;e.forEach(t=>{this.#t.addEventListener(t,s=>{if(!(s.target instanceof HTMLElement))return;let r=s.target,a=`on:${s.type}`,i=`[data-${a.replace(":","\\:")}]`,n=r.dataset[a];!n&&(r=r.closest(i))&&(n=r.dataset[a]),this[n]?.(s)})})}#r(){let{attrs:e}=this.constructor;this.attrs??={},Object.entries(e).forEach(([t,s])=>{let r=s.stringify??(i=>i?.toString()??""),a=s.parse??(i=>i);Object.defineProperty(this.attrs,t,{get:()=>a(this.getAttribute(t)),set:i=>this.setAttribute(t,r(i))}),s.default&&!this.getAttribute(t)&&this.setAttribute(t,s.default())})}};var p='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-frown"><circle cx="12" cy="12" r="10"/><path d="M16 16s-1.5-2-4-2-4 2-4 2"/><line x1="9" x2="9.01" y1="9" y2="9"/><line x1="15" x2="15.01" y1="9" y2="9"/></svg>';function C(e){return new DOMParser().parseFromString(e,"image/svg+xml").documentElement}function m(e){return Object.entries(e).filter(([t,s])=>!!s).map(([t])=>t).join(" ")}var d=class e extends h{static tag="command-bar";static disabledFeatures=["shadow"];static attrs={allowRepeat:{parse:Boolean,default:()=>"true"},emptyMessage:{parse:String,default:()=>"Sorry, couldn\u02BCt find anything."},limitResults:{parse:Number,default:()=>"10"},placeholder:{parse:String,default:()=>"Search..."},hotkey:{parse:JSON.parse,stringify:JSON.stringify,default:()=>'{"key":"k","metaKey":true}'}};static events=["close","input","click"];get template(){return c`
      <dialog class="cb__dialog" data-ref="host" data-on:close="onDialogClose">
        <header class="cb__header">
          <label>
            <span class="visually-hidden" data-ref="searchLabel"></span>
            <input
              type="search"
              data-ref="search"
              data-on:input="onSearch"
              required
            />
          </label>
        </header>

        <div class="cb__body" has-fallback>
          <ul class="cb__results-list" data-ref="results"></ul>

          <div fallback-for="empty">
            <p>${p}</p>
            <p data-ref="emptyMessage"></p>
          </div>
        </div>
      </dialog>
    `}static get instance(){let t=document.querySelectorAll(this.tag);if(t[0]instanceof e)return t.length>1&&console.warn("Found multiple CommandBars. Only the first is returned."),t[0];throw new Error("No CommandBar instance found.")}#t=new AbortController;connectedCallback(){super.connectedCallback(),addEventListener("keydown",t=>this.#m(t),{signal:this.#t.signal}),addEventListener("keydown",t=>this.#h(t),{signal:this.#t.signal}),this.updatePlaceholder(),this.updateEmptyMessage()}disconnectedCallback(){this.#t.abort()}attributeChangedCallback(t){switch(t.toLowerCase()){case"placeholder":this.updatePlaceholder();break;case"emptymessage":this.updateEmptyMessage();break}}#h(t){if(t.key==="."&&t.metaKey&&(this.#w(),t.preventDefault()),!this.#e)return;let s=!0;t.key==="Escape"?this.#p():t.key==="ArrowUp"?this.#y():t.key==="ArrowDown"?this.#g():t.key==="Enter"?this.#b():s=!1,s&&t.preventDefault()}#e=!1;#s=[];#r=new Map;#a=null;#i="";#n=0;#l(t){this.#i=t,this.#o(0),this.ref("search").value=t,this.#f()}#o(t){this.#n=t,this.ref("results").querySelectorAll("button").forEach((r,a)=>{a===t?r.classList.add("cb__result--focused"):r.classList.remove("cb__result--focused")})}#c(t=!this.#e){t!==this.#e&&(t?(this.ref("host").showModal(),this.#e=!0):(this.ref("host").close(),this.#o(0),this.#e=!1,this.#l("")))}updatePlaceholder(){this.ref("searchLabel").textContent=this.attrs.placeholder,this.ref("search").setAttribute("placeholder",this.attrs.placeholder)}updateEmptyMessage(){this.ref("emptyMessage").textContent=this.attrs.emptyMessage}#f(){this.ref("results").innerHTML="",this.#d().forEach((t,s)=>{let r=document.createElement("li"),a=document.createElement("button");a.addEventListener("click",()=>this.#u(t)),a.className=m({cb__result:!0,"cb__result--focused":s===this.#n,"cb__result--chord-match":this.#i===t.chord});let i=document.createElement("span");i.classList.add("cb__icon"),t.icon instanceof Element?i.appendChild(t.icon):typeof t.icon=="string"&&(i.textContent=t.icon),a.appendChild(i);let n=document.createElement("span");n.classList.add("cb__group-name"),n.textContent=t.groupName??"",a.appendChild(n);let l=document.createElement("span");l.dataset.clamp="1",l.textContent=t.name,a.appendChild(l);let o=document.createElement("span");o.classList.add("cb__chord"),o.textContent=t.chord??"",a.appendChild(o),r.appendChild(a),this.ref("results").appendChild(r)})}open(t=""){this.#c(!0),this.#l(t)}onDialogClose(){this.#e=!1}#p(){this.#i?this.#l(""):this.#c(!1)}#m(t){let s=Object.assign({altKey:!1,ctrlKey:!1,metaKey:!1,shiftKey:!1,key:""},this.attrs.hotkey);Object.entries(s).reduce((a,[i,n])=>a&&t[i]===n,!0)&&(this.#c(),t.preventDefault(),t.stopPropagation())}registerCommand(...t){let s=t.map(r=>r.id);return this.removeCommand(...s),this.#s=[...this.#s,...t],t.forEach(r=>{r.chord&&this.#r.set(r.chord,r)}),()=>{this.removeCommand(...s)}}removeCommand(...t){this.#s=this.#s.filter(s=>!t.includes(s.id)),this.#r.forEach((s,r)=>{t.includes(s.id)&&this.#r.delete(r)}),this.#a&&t.includes(this.#a.id)&&(this.#a=null)}onSearch(t){t.target instanceof HTMLInputElement&&this.#l(t.target.value)}#d(){if(!this.#i)return[];let t=this.#r.get(this.#i),s=this.#i.toLowerCase().split(" "),r=this.#s.filter(a=>{if(t&&t.id===a.id)return!1;let i=[a.name,...a.alias??[],a.groupName??""].join(" ").toLowerCase();return s.every(n=>i.includes(n))}).slice(0,this.attrs.limitResults).sort((a,i)=>(i.weight??0)-(a.weight??0));return t&&r.unshift(t),r}#g(){let t=this.#d().length;if(t===0)return;let s=this.#n+1;this.#o(Math.min(t-1,s))}#y(){this.#o(Math.max(this.#n-1,0))}#b(){let t=this.#d().at(this.#n);t&&this.#u(t)}#w(){this.#a&&this.attrs.allowRepeat&&this.#u(this.#a)}#u(t){t.action(),this.#a=t,this.#c(!1)}};export{d as CommandBar,C as renderSvgFromString};
//# sourceMappingURL=commandBar.js.map
