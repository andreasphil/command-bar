var d=(s,...t)=>String.raw({raw:s},...t),l=d;function o(s){let t=document.createElement("template");return t.innerHTML=s,t.content.cloneNode(!0)}var c=class extends HTMLElement{static tag="";static attrs={};static events=[];static define(s=this.tag){if(!s)throw new Error("Custom element must specify a tag name");customElements.define(s,this)}static get observedAttributes(){return Object.keys(this.attrs)}get styles(){}get template(){throw new Error("Custom element must specify a template")}attrs;get#t(){return this.shadowRoot??this}constructor(){super();try{this.attachShadow({mode:"open"})}catch{}}connectedCallback(){this.#h(),this.#e(),this.#r(),this.#s()}ref(s){let t=this.maybeRef(s);if(!t)throw new Error(`Ref with name ${String(s)} was not found`);return t}maybeRef(s){return this.#t.querySelector(`[data-ref="${String(s)}"]`)??void 0}refs(){let s={};return this.#t.querySelectorAll("[data-ref]").forEach(t=>{t instanceof HTMLElement&&t.dataset.ref&&(s[t.dataset.ref]=t)}),s}emit(s,t){let e=new CustomEvent(String(s),{bubbles:!0,cancelable:!0,composed:!0,detail:t});this.dispatchEvent(e)}#h(){if(this.template.startsWith("#")){let s=document.querySelector(this.template);if(!(s instanceof HTMLTemplateElement))throw new Error(`${this.template} is not a template element`);this.#t.appendChild(s.content.cloneNode(!0))}else{let s=o(this.template);this.#t.appendChild(s)}}#e(){if(!this.styles)return;if(!(this.#t instanceof ShadowRoot))throw new Error('CSS is not supported when "shadow" is disabled');let s=new CSSStyleSheet;s.replaceSync(this.styles),this.#t.adoptedStyleSheets.push(s)}#s(){let{events:s}=this.constructor;s.forEach(t=>{this.#t.addEventListener(t,e=>{if(!(e.target instanceof HTMLElement))return;let r=e.target,a=`on:${e.type}`,i=`[data-${a.replace(":","\\:")}]`,n=r.dataset[a];!n&&(r=r.closest(i))&&(n=r.dataset[a]),this[n]?.(e)})})}#r(){let{attrs:s}=this.constructor;this.attrs??={},Object.entries(s).forEach(([t,e])=>{let r=e.stringify??(i=>i?.toString()??""),a=e.parse??(i=>i);Object.defineProperty(this.attrs,t,{get:()=>a(this.getAttribute(t)),set:i=>this.setAttribute(t,r(i))}),e.default&&!this.getAttribute(t)&&this.setAttribute(t,e.default())})}};var u='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-frown"><circle cx="12" cy="12" r="10"/><path d="M16 16s-1.5-2-4-2-4 2-4 2"/><line x1="9" x2="9.01" y1="9" y2="9"/><line x1="15" x2="15.01" y1="9" y2="9"/></svg>';function y(s){return new DOMParser().parseFromString(s,"image/svg+xml").documentElement}function f(s){return Object.entries(s).filter(([t,e])=>!!e).map(([t])=>t).join(" ")}var h=class s extends c{static tag="command-bar";static disabledFeatures=["shadow"];static attrs={allowRepeat:{parse:Boolean,default:()=>"true"},emptyMessage:{parse:String,default:()=>"Sorry, couldn\u02BCt find anything."},limitResults:{parse:Number,default:()=>"10"},placeholder:{parse:String,default:()=>"Search..."},hotkey:{parse:JSON.parse,stringify:JSON.stringify,default:()=>'{"key":"k","metaKey":true}'}};static events=["close","input","click"];get template(){return l`
      <dialog class="cb__dialog" data-ref="host" data-on:close="onDialogClose">
        <header class="cb__header">
          <label>
            <span data-hidden data-ref="searchLabel"></span>
            <input
              type="search"
              data-ref="search"
              data-on:input="onSearch"
              required
            />
          </label>
        </header>

        <div class="cb__body" data-with-fallback>
          <ul class="cb__results-list" data-ref="results"></ul>

          <div data-when="empty">
            <p>${u}</p>
            <p data-ref="emptyMessage"></p>
          </div>
        </div>
      </dialog>
    `}static get instance(){let t=document.querySelectorAll(this.tag);if(t[0]instanceof s)return t.length>1&&console.warn("Found multiple CommandBars. Only the first is returned."),t[0];throw new Error("No CommandBar instance found.")}#t=new AbortController;connectedCallback(){super.connectedCallback(),addEventListener("keydown",t=>this.#g(t),{signal:this.#t.signal}),addEventListener("keydown",t=>this.#h(t),{signal:this.#t.signal}),this.updatePlaceholder(),this.updateEmptyMessage()}disconnectedCallback(){this.#t.abort()}attributeChangedCallback(t){switch(t.toLowerCase()){case"placeholder":this.updatePlaceholder();break;case"emptymessage":this.updateEmptyMessage();break}}#h(t){if(t.key==="."&&t.metaKey&&(this.#C(),t.preventDefault()),!this.#e)return;let e=!0;t.key==="Escape"?this.#m():t.key==="ArrowUp"?this.#b():t.key==="ArrowDown"?this.#y():t.key==="Enter"?this.#w():e=!1,e&&t.preventDefault()}#e=!1;#s=[];#r=new Map;#a=null;#i="";#n=0;#l(t){this.#i=t,this.#o(0),this.ref("search").value=t,this.#f()}#o(t){this.#n=t,this.ref("results").querySelectorAll("button").forEach((r,a)=>{a===t?r.classList.add("cb__result--focused"):r.classList.remove("cb__result--focused")})}#c(t=!this.#e){t!==this.#e&&(t?(this.ref("host").showModal(),this.#e=!0):(this.ref("host").close(),this.#o(0),this.#e=!1,this.#l("")))}updatePlaceholder(){this.ref("searchLabel").textContent=this.attrs.placeholder,this.ref("search").setAttribute("placeholder",this.attrs.placeholder)}updateEmptyMessage(){this.ref("emptyMessage").textContent=this.attrs.emptyMessage}#f(){this.ref("results").innerHTML="",this.#d().forEach((t,e)=>{let r=this.#p(t,{focused:e===this.#n,chordMatch:this.#i===t.chord});this.ref("results").appendChild(r)})}#p(t,e){let r=f({cb__result:!0,"cb__result--focused":e.focused,"cb__result--chord-match":e.chordMatch}),a=l`<li>
      <button class="${r}">
        <span class="cb__icon"></span
        ><span class="cb__group-name">${t.groupName??""}</span
        ><span data-clamp="1">${t.name}</span
        ><span class="cb__chord">${t.chord??""}</span>
      </button>
    </li>`.replace(/(\n|\s{2,})/g,""),i=o(a);return t.icon instanceof Element?i.querySelector(".cb__icon").appendChild(t.icon):typeof t.icon=="string"&&(i.querySelector(".cb__icon").textContent=t.icon),i.querySelector("button").addEventListener("click",()=>this.#u(t)),i}open(t=""){this.#c(!0),this.#l(t)}onDialogClose(){this.#e=!1}#m(){this.#i?this.#l(""):this.#c(!1)}#g(t){let e=Object.assign({altKey:!1,ctrlKey:!1,metaKey:!1,shiftKey:!1,key:""},this.attrs.hotkey);Object.entries(e).reduce((a,[i,n])=>a&&t[i]===n,!0)&&(this.#c(),t.preventDefault(),t.stopPropagation())}registerCommand(...t){let e=t.map(r=>r.id);return this.removeCommand(...e),this.#s=[...this.#s,...t],t.forEach(r=>{r.chord&&this.#r.set(r.chord,r)}),()=>{this.removeCommand(...e)}}removeCommand(...t){this.#s=this.#s.filter(e=>!t.includes(e.id)),this.#r.forEach((e,r)=>{t.includes(e.id)&&this.#r.delete(r)}),this.#a&&t.includes(this.#a.id)&&(this.#a=null)}onSearch(t){t.target instanceof HTMLInputElement&&this.#l(t.target.value)}#d(){if(!this.#i)return[];let t=this.#r.get(this.#i),e=this.#i.toLowerCase().split(" "),r=this.#s.filter(a=>{if(t&&t.id===a.id)return!1;let i=[a.name,...a.alias??[],a.groupName??""].join(" ").toLowerCase();return e.every(n=>i.includes(n))}).slice(0,this.attrs.limitResults).sort((a,i)=>(i.weight??0)-(a.weight??0));return t&&r.unshift(t),r}#y(){let t=this.#d().length;if(t===0)return;let e=this.#n+1;this.#o(Math.min(t-1,e))}#b(){this.#o(Math.max(this.#n-1,0))}#w(){let t=this.#d().at(this.#n);t&&this.#u(t)}#C(){this.#a&&this.attrs.allowRepeat&&this.#u(this.#a)}#u(t){t.action(),this.#a=t,this.#c(!1)}};export{h as CommandBar,y as renderSvgFromString};
//# sourceMappingURL=commandBar.js.map
